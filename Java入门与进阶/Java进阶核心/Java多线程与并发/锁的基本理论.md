### **悲观锁、乐观锁的概念及使用场景**

悲观锁：总是假设最坏的情况，每次拿数据的时候都认为别人会去修改，所以每次在拿数据的时候都会上锁，这样别人想拿数据就会被阻塞直到拿到锁。应用：传统关系型数据库，如行锁，表锁，读锁，写锁等，还有synchonized和ReentrantLock等独占锁。适用于多写场景

乐观锁：总是假设最好的情况，即拿数据的时候都认为别人不会去修改，所以不会上锁，但是在更新的时候回去判断在此期间别人有没有修改。可以使用版本号和CAS算法实现。乐观锁适用于多读的场景。

### **乐观锁的两种常用实现方式**

1. 版本号机制

2. 1. 在数据表中增加版本号字段，一般是version，代表数据被修改的次数，当数据被修改时version+1
   2. 当线程A更新数据时，还会读取version值。在提交更新时，如果数据库中的version值等于读取出来的version值才会更新。否则提交失败，需要重试知道更新成功

3. CAS算法

4. 1. 无锁算法，即在不使用锁的情况下对多线程之间的变量进行同步、CAS算法涉及到三个操作数：

   2. 1. 需要读写的内存值V
      2. 进行比较的值A
      3. 拟写入的新值B

   3. 当且仅当V==A时，才会通过CAS的原子方式用B更新V，否则不会进行任何操作（比较和替换是一个原子操作）。一般情况下是一个自旋操作，即不断地重试。